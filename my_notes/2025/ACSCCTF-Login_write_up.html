<div id="doc" class="markdown-body container-fluid comment-inner comment-enabled" data-hard-breaks="true" lang="en-US"><h1 id="Login-write-up" data-id="Login-write-up"><span>ACSC CTF 2024 Login write up</span></h1><blockquote>
<p><span>Ans：</span><mark><span>ACSC{fake}</span></mark></p>
</blockquote><p><span>這題進入頁面後，是一個 Login 畫面。</span></p><p><span class="image-toolbar-wrapper inline-block w-fit h-fit [&amp;:not([data-image-error])]:cursor-zoom-in" style="width: auto; height: auto;"><div class="code-toolbar cursor-default tw-hide md:block"><div class="flex flex-row gap-0.5 rounded-lg bg-element-bg-default px-[7px] py-[5px]"><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-edit-from-here-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-map-pin-simple" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><span class="ml-1 border-0 border-l border-solid border-background-subtle pr-1" aria-hidden="true"></span><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-link-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-link" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-zoom-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-magnifying-glass-plus" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button></div></div><img src="https://hackmd.io/_uploads/HJeW8Hf_ll.png" alt="image" class="offline-handled error-handled image-toolbar-handled" loading="lazy" style="width: auto; height: auto;"></span></p><p><span>老方法一樣先猜 </span><code>admin:admin</code><span>。</span></p><p><span class="image-toolbar-wrapper inline-block w-fit h-fit [&amp;:not([data-image-error])]:cursor-zoom-in" style="width: auto; height: auto;"><div class="code-toolbar cursor-default tw-hide md:block"><div class="flex flex-row gap-0.5 rounded-lg bg-element-bg-default px-[7px] py-[5px]"><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-edit-from-here-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-map-pin-simple" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><span class="ml-1 border-0 border-l border-solid border-background-subtle pr-1" aria-hidden="true"></span><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-link-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-link" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-zoom-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-magnifying-glass-plus" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button></div></div><img src="https://hackmd.io/_uploads/BJTmLrGOxg.png" alt="image" class="offline-handled error-handled image-toolbar-handled" loading="lazy" style="width: auto; height: auto;"></span></p><p><span>顯然他沒那麼笨，所以我先看看題目給的 source code。</span></p><details><summary><span><span>完整程式碼</span></span></summary>

      <div class="code-block-wrapper code-block-toolbar-handled" data-infoprefix-length="2" data-startline-back="16" data-endline-back="70"><div class="code-toolbar"><div class="flex flex-row gap-0.5 rounded-lg bg-element-bg-default px-[7px] py-[5px]"><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-edit-from-here-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-map-pin-simple" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><span class="ml-1 border-0 border-l border-solid border-background-subtle pr-1" aria-hidden="true"></span><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-link-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-link" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-clipboard-text" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button></div></div>
        <pre class="click-event-handled"><code class="js hljs"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FLAG</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">FLAG</span> || <span class="hljs-string">'flag{this_is_a_fake_flag}'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> }));

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">USER_DB</span> = {
    <span class="hljs-attr">user</span>: {
        <span class="hljs-attr">username</span>: <span class="hljs-string">'user'</span>, 
        <span class="hljs-attr">password</span>: crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">32</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">'hex'</span>)
    },
    <span class="hljs-attr">guest</span>: {
        <span class="hljs-attr">username</span>: <span class="hljs-string">'guest'</span>,
        <span class="hljs-attr">password</span>: <span class="hljs-string">'guest'</span>
    }
};

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`
    &lt;html&gt;&lt;head&gt;&lt;title&gt;Login&lt;/title&gt;&lt;link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css"&gt;&lt;/head&gt;
    &lt;body&gt;
    &lt;section&gt;
    &lt;h1&gt;Login&lt;/h1&gt;
    &lt;form action="/login" method="post"&gt;
    &lt;input type="text" name="username" placeholder="Username" length="6" required&gt;
    &lt;input type="password" name="password" placeholder="Password" required&gt;
    &lt;button type="submit"&gt;Login&lt;/button&gt;
    &lt;/form&gt;
    &lt;/section&gt;
    &lt;/body&gt;&lt;/html&gt;
    `</span>);
});

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/login'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { username, password } = req.<span class="hljs-property">body</span>;
    <span class="hljs-keyword">if</span> (username.<span class="hljs-property">length</span> &gt; <span class="hljs-number">6</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Username is too long'</span>);

    <span class="hljs-keyword">const</span> user = <span class="hljs-variable constant_">USER_DB</span>[username];
    <span class="hljs-keyword">if</span> (user &amp;&amp; user.<span class="hljs-property">password</span> == password) {
        <span class="hljs-keyword">if</span> (username === <span class="hljs-string">'guest'</span>) {
            res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Welcome, guest. You do not have permission to view the flag'</span>);
        } <span class="hljs-keyword">else</span> {
            res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`Welcome, <span class="hljs-subst">${username}</span>. Here is your flag: <span class="hljs-subst">${FLAG}</span>`</span>);
        }
    } <span class="hljs-keyword">else</span> {
        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Invalid username or password'</span>);
    }
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">5000</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Server is running on port 5000'</span>);
});
</code></pre>
      </div>
      
</details><p><span>在資料庫的地方他有兩筆資料，分別是 guest 跟 user，只是 user 的密碼是 </span><mark><span>32 字元長的隨機十六進位字串</span></mark><span>。</span></p><div class="code-block-wrapper code-block-toolbar-handled" data-infoprefix-length="2"><div class="code-toolbar"><div class="flex flex-row gap-0.5 rounded-lg bg-element-bg-default px-[7px] py-[5px]"><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-edit-from-here-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-map-pin-simple" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><span class="ml-1 border-0 border-l border-solid border-background-subtle pr-1" aria-hidden="true"></span><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-link-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-link" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-clipboard-text" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button></div></div>
        <pre class="click-event-handled"><code class="js hljs"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">USER_DB</span> = {
    <span class="hljs-attr">user</span>: {
        <span class="hljs-attr">username</span>: <span class="hljs-string">'user'</span>, 
        <span class="hljs-attr">password</span>: crypto.<span class="hljs-title function_">randomBytes</span>(<span class="hljs-number">32</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">'hex'</span>)
    },
    <span class="hljs-attr">guest</span>: {
        <span class="hljs-attr">username</span>: <span class="hljs-string">'guest'</span>,
        <span class="hljs-attr">password</span>: <span class="hljs-string">'guest'</span>
    }
};
</code></pre>
      </div><p><span>接著檢查 username 有沒有超過 6 個字元，不然就報錯。</span></p><div class="code-block-wrapper code-block-toolbar-handled" data-infoprefix-length="2"><div class="code-toolbar"><div class="flex flex-row gap-0.5 rounded-lg bg-element-bg-default px-[7px] py-[5px]"><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-edit-from-here-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-map-pin-simple" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><span class="ml-1 border-0 border-l border-solid border-background-subtle pr-1" aria-hidden="true"></span><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-link-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-link" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-clipboard-text" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button></div></div>
        <pre class="click-event-handled"><code class="js hljs">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/login'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { username, password } = req.<span class="hljs-property">body</span>;
    <span class="hljs-keyword">if</span> (username.<span class="hljs-property">length</span> &gt; <span class="hljs-number">6</span>) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Username is too long'</span>);
</code></pre>
      </div><p><span>接著會去資料庫裡面，對比 username 去找資料，然後對比帳密。</span></p><div class="code-block-wrapper code-block-toolbar-handled" data-infoprefix-length="2"><div class="code-toolbar"><div class="flex flex-row gap-0.5 rounded-lg bg-element-bg-default px-[7px] py-[5px]"><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-edit-from-here-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-map-pin-simple" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><span class="ml-1 border-0 border-l border-solid border-background-subtle pr-1" aria-hidden="true"></span><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-link-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-link" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-clipboard-text" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button></div></div>
        <pre class="click-event-handled"><code class="js hljs"><span class="hljs-keyword">const</span> user = <span class="hljs-variable constant_">USER_DB</span>[username];
<span class="hljs-keyword">if</span> (user &amp;&amp; user.<span class="hljs-property">password</span> == password) {
</code></pre>
      </div><p><span>是 guest 就回傳文本，反之就是 flag。</span></p><div class="code-block-wrapper code-block-toolbar-handled" data-infoprefix-length="2"><div class="code-toolbar"><div class="flex flex-row gap-0.5 rounded-lg bg-element-bg-default px-[7px] py-[5px]"><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-edit-from-here-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-map-pin-simple" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><span class="ml-1 border-0 border-l border-solid border-background-subtle pr-1" aria-hidden="true"></span><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-link-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-link" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-clipboard-text" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button></div></div>
        <pre class="click-event-handled"><code class="js hljs">    <span class="hljs-keyword">if</span> (username === <span class="hljs-string">'guest'</span>) {
        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Welcome, guest. You do not have permission to view the flag'</span>);
    } <span class="hljs-keyword">else</span> {
        res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`Welcome, <span class="hljs-subst">${username}</span>. Here is your flag: <span class="hljs-subst">${FLAG}</span>`</span>);
    }
} <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Invalid username or password'</span>);
}
});
</code></pre>
      </div><p><span>我們現在要做的，就是用程式邏輯去混淆他。這裡 user 的密碼都是亂數生成，爆破根本沒意義，但如果讓 guest 成為可以讀 flag 的角色呢？</span></p><p><span>一樣用 </span><code>guest:guest</code><span> 去登入他，但是我們加上 </span><code>[]</code><span>。</span></p><p><span class="image-toolbar-wrapper inline-block w-fit h-fit [&amp;:not([data-image-error])]:cursor-zoom-in" style="width: auto; height: auto;"><div class="code-toolbar cursor-default tw-hide md:block"><div class="flex flex-row gap-0.5 rounded-lg bg-element-bg-default px-[7px] py-[5px]"><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-edit-from-here-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-map-pin-simple" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><span class="ml-1 border-0 border-l border-solid border-background-subtle pr-1" aria-hidden="true"></span><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-link-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-link" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-zoom-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-magnifying-glass-plus" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button></div></div><img src="https://hackmd.io/_uploads/ByVpVUfugg.png" alt="image" class="offline-handled error-handled image-toolbar-handled" loading="lazy" style="width: auto; height: auto;"></span></p><p><span>這會造成我們輸入的東西是以 </span><mark><span>陣列</span></mark><span> 去執行，JS 會將陣列 </span><code>['guest']</code><span> 自動轉成字串 </span><code>'guest'</code><span>，所以查詢成功，在資料庫中會變成這樣：</span></p><div class="code-block-wrapper code-block-toolbar-handled" data-infoprefix-length="2"><div class="code-toolbar"><div class="flex flex-row gap-0.5 rounded-lg bg-element-bg-default px-[7px] py-[5px]"><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-edit-from-here-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-map-pin-simple" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><span class="ml-1 border-0 border-l border-solid border-background-subtle pr-1" aria-hidden="true"></span><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-link-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-link" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-button ui-code-block-toolbar-type-code" data-state="closed"><i class="inline-flex ph ph-clipboard-text" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button></div></div>
        <pre class="click-event-handled"><code class="js hljs"><span class="hljs-variable constant_">USER_DB</span>[[<span class="hljs-string">'guest'</span>]]
</code></pre>
      </div><p><span>我們的帳密都是 guest，這裡資料庫就會通過，但為何後面不是走 guest 分支，而是炸 user 的內容還不會被擋下來，有兩點：</span></p><ul>
<li><span>陣列長度為 1，不超過 6，因此使用者字元長度限制會被繞過。</span></li>
<li><code>==</code><span> 其實是寬鬆比對，在 JS 中會先將陣列轉成字串，導致結果相等，進而通過密碼驗證，但後續判斷使用者名稱不成立，是因為我們傳的是陣列 </span><code>['guest']</code><span>，不等於字串 </span><code>'guest'</code><span>。</span></li>
</ul><p><span>所以利用 JS 的隱式轉換會把 </span><code>username[]=guest</code><span> 轉成陣列 </span><code>['guest']</code><span>，正是本題漏洞核心，因此 else 被執行，回傳 flag。</span></p><p><span>這裡就會變成：</span></p><ul>
<li><span>資料庫確定有這支帳號，且同意我們登入。</span></li>
<li><span>else 條件滿足，因此吐 flag 出來。</span></li>
</ul><p><span class="image-toolbar-wrapper inline-block w-fit h-fit [&amp;:not([data-image-error])]:cursor-zoom-in" style="width: auto; height: auto;"><div class="code-toolbar cursor-default tw-hide md:block"><div class="flex flex-row gap-0.5 rounded-lg bg-element-bg-default px-[7px] py-[5px]"><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-edit-from-here-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-map-pin-simple" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><span class="ml-1 border-0 border-l border-solid border-background-subtle pr-1" aria-hidden="true"></span><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-copy-link-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-link" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button><button class="rounded text-lg font-normal leading-sm flex bg-transparent text-text-default border border-solid border-transparent hocus:bg-element-bg-hover hocus:text-text-emphasize hover:border-element-bg-hover focus:shadow-[0_0_0_2px_#77777733] focus:border-element-border-hover disabled:bg-transparent disabled:hocus:bg-transparent disabled:hocus:border-transparent disabled:text-element-text-disabled disabled:hocus:text-element-text-disabled p-0.5 ui-code-block-zoom-button ui-code-block-toolbar-type-image" data-state="closed"><i class="inline-flex ph ph-magnifying-glass-plus" aria-hidden="true" style="width: 20px; height: 20px; font-size: 20px; line-height: 20px;"></i></button></div></div><img src="https://hackmd.io/_uploads/SJizYUMdex.png" alt="image" class="offline-handled error-handled image-toolbar-handled" loading="lazy" style="width: auto; height: auto;"></span></p><hr></div>